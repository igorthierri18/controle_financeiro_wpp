{% extends 'base.html' %}

{% block title %}Lembretes - {{ app_name }}{% endblock %}

{% block custom_styles %}
.lembretes-header {
    background: linear-gradient(135deg, #28a745, #218838);
    padding: 15px 0;
    color: white;
    margin-bottom: 20px;
}

.lembretes-header h1 {
    font-weight: 600;
    font-size: 1.8rem;
    margin-bottom: 0.2rem;
}

.lembretes-header p {
    opacity: 0.9;
    margin-bottom: 0;
    font-size: 0.9rem;
}

.lembrete-compact {
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    margin-bottom: 8px;
    position: relative;
    overflow: hidden;
    padding: 0;
}

.lembrete-compact:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.lembrete-status-bar {
    width: 5px;
    height: 100%;
    position: absolute;
    left: 0;
    top: 0;
}

.lembrete-status-normal {
    background-color: #28a745;
}

.lembrete-status-warning {
    background-color: #ffc107;
}

.lembrete-status-danger {
    background-color: #dc3545;
}

.lembrete-status-info {
    background-color: #17a2b8;
}

.lembrete-compact-body {
    padding: 10px 10px 10px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.lembrete-compact-info {
    flex-grow: 1;
    padding-left: 5px;
}

.lembrete-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.lembrete-date {
    color: #6c757d;
    font-size: 12px;
    margin-bottom: 0;
}

.lembrete-value {
    font-size: 14px;
    font-weight: 700;
    color: #28a745;
}

.lembrete-compact-tags {
    display: flex;
    gap: 5px;
    margin-right: 5px;
}

.lembrete-tag {
    display: inline-block;
    padding: 3px 6px;
    border-radius: 12px;
    font-size: 10px;
}

.lembrete-tag-personal {
    background-color: #e8f5e9;
    color: #2e7d32;
}

.lembrete-tag-business {
    background-color: #e3f2fd;
    color: #1565c0;
}

.lembrete-tag-recurrent {
    background-color: #fff3e0;
    color: #e65100;
}

.lembrete-compact-actions {
    display: flex;
    gap: 5px;
}

.lembrete-compact-actions .btn {
    padding: 3px 6px;
    font-size: 12px;
}

.empty-state {
    text-align: center;
    padding: 20px;
    margin-top: 20px;
}

.empty-state i {
    font-size: 32px;
    color: #dee2e6;
    margin-bottom: 10px;
}

.empty-state h3 {
    font-weight: 600;
    margin-bottom: 10px;
    color: #495057;
    font-size: 1.2rem;
}

.empty-state p {
    color: #6c757d;
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.fab-button {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 50px;
    height: 50px;
    background-color: #28a745;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    text-decoration: none;
}

.fab-button:hover {
    background-color: #218838;
    transform: scale(1.05);
    color: white;
}

.filter-bar {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.filter-bar .btn {
    border-radius: 20px;
    padding: 5px 12px;
    font-size: 13px;
}

.filter-dropdown {
    position: relative;
}

.filter-dropdown .dropdown-menu {
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    padding: 10px;
}

.calendar-view {
    background-color: #fff;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    padding: 15px;
    margin-bottom: 20px;
}

.calendar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
}

.calendar-title {
    font-weight: 600;
    font-size: 16px;
}

.calendar-nav {
    display: flex;
    gap: 5px;
}

.calendar-nav .btn {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    font-size: 12px;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
}

.calendar-weekday {
    text-align: center;
    font-weight: 500;
    color: #6c757d;
    padding: 5px 0;
    font-size: 12px;
}

.calendar-day {
    aspect-ratio: 1/1;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    padding: 3px;
    position: relative;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    transition: all 0.2s ease;
    font-size: 12px;
}

.calendar-day:hover {
    background-color: #f8f9fa;
}

.calendar-day.other-month {
    background-color: #f8f9fa;
    border-color: #f1f1f1;
    color: #adb5bd;
}

.calendar-day.today {
    border-color: #28a745;
    background-color: #e8f5e9;
}

.calendar-day-number {
    font-weight: 500;
    margin-bottom: 2px;
    text-align: center;
}

.calendar-day-events {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 2px;
    overflow: hidden;
}

.calendar-day-event {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: #28a745;
}

.calendar-day-event.personal {
    background-color: #28a745;
}

.calendar-day-event.business {
    background-color: #007bff;
}

.lembretes-section {
    background-color: #fff;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    padding: 15px;
    height: 100%;
    max-height: 700px;
    overflow-y: auto;
}

.lembretes-section h3 {
    font-size: 16px;
    margin-bottom: 15px;
    font-weight: 600;
}

.section-tabs {
    display: flex;
    border-bottom: 1px solid #dee2e6;
    margin-bottom: 15px;
}

.section-tab {
    padding: 8px 15px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border-bottom: 2px solid transparent;
}

.section-tab.active {
    color: #28a745;
    border-bottom-color: #28a745;
}

.lembrete-countdown {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: 600;
}

.lembrete-countdown-normal {
    background-color: #e8f5e9;
    color: #2e7d32;
}

.lembrete-countdown-warning {
    background-color: #fff3e0;
    color: #e65100;
}

.lembrete-countdown-danger {
    background-color: #ffebee;
    color: #c62828;
}

.lembrete-countdown-today {
    background-color: #e3f2fd;
    color: #1565c0;
}

/* Estilos responsivos */
@media (max-width: 992px) {
    .row-reverse-on-mobile {
        flex-direction: column-reverse;
    }
    
    .calendar-view, .lembretes-section {
        margin-bottom: 20px;
    }
    
    .fab-button {
        bottom: 20px;
        right: 20px;
        width: 45px;
        height: 45px;
        font-size: 18px;
    }
}

@media (max-width: 576px) {
    .lembretes-header {
        padding: 10px 0;
    }
    
    .lembretes-header h1 {
        font-size: 1.5rem;
    }
    
    .filter-bar {
        justify-content: center;
    }
}
{% endblock %}

{% block content %}
<!-- Cabeçalho reduzido -->
<div class="lembretes-header">
    <div class="container">
        <h1>Meus Lembretes</h1>
        <p>Gerencie seus lembretes financeiros e receba notificações</p>
    </div>
</div>

<div class="container">
    <!-- Barra de filtros -->
    <div class="filter-bar">
        <button class="btn btn-success active" id="btn-todos-lembretes">Todos</button>
        <button class="btn btn-outline-success" id="btn-proximos-lembretes">Próximos 7 dias</button>
        <button class="btn btn-outline-success" id="btn-lembretes-vencidos">Vencidos</button>
        
        <div class="filter-dropdown ms-auto">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-filter"></i> Filtrar
            </button>
            <div class="dropdown-menu dropdown-menu-end">
                <h6 class="dropdown-header">Tipo de Perfil</h6>
                <div class="dropdown-item">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="filtro-pessoal" checked>
                        <label class="form-check-label" for="filtro-pessoal">
                            Pessoal
                        </label>
                    </div>
                </div>
                <div class="dropdown-item">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="filtro-empresarial" checked>
                        <label class="form-check-label" for="filtro-empresarial">
                            Empresarial
                        </label>
                    </div>
                </div>
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-header">Tipo de Lembrete</h6>
                <div class="dropdown-item">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="filtro-recorrentes" checked>
                        <label class="form-check-label" for="filtro-recorrentes">
                            Recorrentes
                        </label>
                    </div>
                </div>
                <div class="dropdown-item">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="filtro-unicos" checked>
                        <label class="form-check-label" for="filtro-unicos">
                            Únicos
                        </label>
                    </div>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item text-center">
                    <button class="btn btn-sm btn-success" id="btn-aplicar-filtros">Aplicar Filtros</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Layout com calendário à esquerda e lista à direita -->
    <div class="row row-reverse-on-mobile">
        <!-- Calendário à esquerda -->
        <div class="col-lg-5">
            <div class="calendar-view">
                <div class="calendar-header">
                    <div class="calendar-title" id="calendar-month-year">Maio 2025</div>
                    <div class="calendar-nav">
                        <button class="btn btn-outline-secondary" id="btn-prev-month">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <button class="btn btn-outline-success" id="btn-today">Hoje</button>
                        <button class="btn btn-outline-secondary" id="btn-next-month">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="calendar-grid">
                    <!-- Dias da semana -->
                    <div class="calendar-weekday">Dom</div>
                    <div class="calendar-weekday">Seg</div>
                    <div class="calendar-weekday">Ter</div>
                    <div class="calendar-weekday">Qua</div>
                    <div class="calendar-weekday">Qui</div>
                    <div class="calendar-weekday">Sex</div>
                    <div class="calendar-weekday">Sáb</div>
                    
                    <!-- Os dias do mês serão inseridos aqui via JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Lista de lembretes à direita -->
        <div class="col-lg-7">
            <div class="lembretes-section">
                <div class="section-tabs">
                    <div class="section-tab active" id="tab-todos">Todos os Lembretes</div>
                    <div class="section-tab" id="tab-pessoais">Pessoais</div>
                    <div class="section-tab" id="tab-empresariais">Empresariais</div>
                </div>
                
                <div id="todos-lembretes">
                    {% if lembretes_pessoais or lembretes_empresariais %}
                        {% for lembrete in lembretes_pessoais %}
                            <div class="lembrete-compact">
                                <div class="lembrete-status-bar 
                                    {% if (lembrete.data|to_date - today).days < 0 %}
                                        lembrete-status-danger
                                    {% elif (lembrete.data|to_date - today).days <= 3 %}
                                        lembrete-status-warning
                                    {% elif (lembrete.data|to_date - today).days <= 7 %}
                                        lembrete-status-info
                                    {% else %}
                                        lembrete-status-normal
                                    {% endif %}
                                "></div>
                                <div class="lembrete-compact-body">
                                    <div class="lembrete-compact-info">
                                        <h4 class="lembrete-title">{{ lembrete.titulo }}</h4>
                                        <div class="d-flex align-items-center">
                                            <div class="lembrete-date me-2">
                                                <i class="bi bi-calendar-event"></i> 
                                                {{ lembrete.data|to_date|format_date }}
                                            </div>
                                            
                                            <div class="lembrete-countdown 
                                                {% if (lembrete.data|to_date - today).days < 0 %}
                                                    lembrete-countdown-danger
                                                {% elif (lembrete.data|to_date - today).days == 0 %}
                                                    lembrete-countdown-today
                                                {% elif (lembrete.data|to_date - today).days <= 3 %}
                                                    lembrete-countdown-warning
                                                {% else %}
                                                    lembrete-countdown-normal
                                                {% endif %}
                                            ">
                                                {% if (lembrete.data|to_date - today).days < 0 %}
                                                    <i class="bi bi-exclamation-triangle"></i> {{ (today - lembrete.data|to_date).days }}d atraso
                                                {% elif (lembrete.data|to_date - today).days == 0 %}
                                                    <i class="bi bi-calendar-check"></i> Hoje!
                                                {% elif (lembrete.data|to_date - today).days == 1 %}
                                                    <i class="bi bi-calendar-date"></i> Amanhã
                                                {% else %}
                                                    <i class="bi bi-calendar"></i> {{ (lembrete.data|to_date - today).days }}d
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {% if lembrete.valor %}
                                    <div class="lembrete-value me-2">R$ {{ lembrete.valor|format_currency }}</div>
                                    {% endif %}
                                    
                                    <div class="lembrete-compact-tags">
                                        <span class="lembrete-tag lembrete-tag-personal">P</span>
                                        
                                        {% if lembrete.recorrente %}
                                        <span class="lembrete-tag lembrete-tag-recurrent">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="lembrete-compact-actions">
                                        <button class="btn btn-sm btn-success btn-concluir-lembrete" data-id="{{ lembrete.id }}" title="Concluir">
                                            <i class="bi bi-check"></i>
                                        </button>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li>
                                                    <a class="dropdown-item btn-editar-lembrete" href="#" data-id="{{ lembrete.id }}">
                                                        <i class="bi bi-pencil me-2"></i> Editar
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item btn-excluir-lembrete text-danger" href="#" data-id="{{ lembrete.id }}">
                                                        <i class="bi bi-trash me-2"></i> Excluir
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                        
                        {% for lembrete in lembretes_empresariais %}
                            <div class="lembrete-compact">
                                <div class="lembrete-status-bar 
                                    {% if (lembrete.data|to_date - today).days < 0 %}
                                        lembrete-status-danger
                                    {% elif (lembrete.data|to_date - today).days <= 3 %}
                                        lembrete-status-warning
                                    {% elif (lembrete.data|to_date - today).days <= 7 %}
                                        lembrete-status-info
                                    {% else %}
                                        lembrete-status-normal
                                    {% endif %}
                                "></div>
                                <div class="lembrete-compact-body">
                                    <div class="lembrete-compact-info">
                                        <h4 class="lembrete-title">{{ lembrete.titulo }}</h4>
                                        <div class="d-flex align-items-center">
                                            <div class="lembrete-date me-2">
                                                <i class="bi bi-calendar-event"></i> 
                                                {{ lembrete.data|to_date|format_date }}
                                            </div>
                                            
                                            <div class="lembrete-countdown 
                                                {% if (lembrete.data|to_date - today).days < 0 %}
                                                    lembrete-countdown-danger
                                                {% elif (lembrete.data|to_date - today).days == 0 %}
                                                    lembrete-countdown-today
                                                {% elif (lembrete.data|to_date - today).days <= 3 %}
                                                    lembrete-countdown-warning
                                                {% else %}
                                                    lembrete-countdown-normal
                                                {% endif %}
                                            ">
                                                {% if (lembrete.data|to_date - today).days < 0 %}
                                                    <i class="bi bi-exclamation-triangle"></i> {{ (today - lembrete.data|to_date).days }}d atraso
                                                {% elif (lembrete.data|to_date - today).days == 0 %}
                                                    <i class="bi bi-calendar-check"></i> Hoje!
                                                {% elif (lembrete.data|to_date - today).days == 1 %}
                                                    <i class="bi bi-calendar-date"></i> Amanhã
                                                {% else %}
                                                    <i class="bi bi-calendar"></i> {{ (lembrete.data|to_date - today).days }}d
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {% if lembrete.valor %}
                                    <div class="lembrete-value me-2">R$ {{ lembrete.valor|format_currency }}</div>
                                    {% endif %}
                                    
                                    <div class="lembrete-compact-tags">
                                        <span class="lembrete-tag lembrete-tag-business">E</span>
                                        
                                        {% if lembrete.recorrente %}
                                        <span class="lembrete-tag lembrete-tag-recurrent">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="lembrete-compact-actions">
                                        <button class="btn btn-sm btn-success btn-concluir-lembrete" data-id="{{ lembrete.id }}" title="Concluir">
                                            <i class="bi bi-check"></i>
                                        </button>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li>
                                                    <a class="dropdown-item btn-editar-lembrete" href="#" data-id="{{ lembrete.id }}">
                                                        <i class="bi bi-pencil me-2"></i> Editar
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item btn-excluir-lembrete text-danger" href="#" data-id="{{ lembrete.id }}">
                                                        <i class="bi bi-trash me-2"></i> Excluir
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <i class="bi bi-bell"></i>
                            <h3>Nenhum lembrete</h3>
                            <p>Adicione lembretes para não esquecer datas importantes.</p>
                            <button class="btn btn-success btn-adicionar-lembrete">
                                <i class="bi bi-plus-circle"></i> Adicionar Lembrete
                            </button>
                        </div>
                    {% endif %}
                </div>
                
                <div id="pessoais-lembretes" style="display: none;">
                    {% if lembretes_pessoais %}
                        {% for lembrete in lembretes_pessoais %}
                            <div class="lembrete-compact">
                                <div class="lembrete-status-bar 
                                    {% if (lembrete.data|to_date - today).days < 0 %}
                                        lembrete-status-danger
                                    {% elif (lembrete.data|to_date - today).days <= 3 %}
                                        lembrete-status-warning
                                    {% elif (lembrete.data|to_date - today).days <= 7 %}
                                        lembrete-status-info
                                    {% else %}
                                        lembrete-status-normal
                                    {% endif %}
                                "></div>
                                <div class="lembrete-compact-body">
                                    <div class="lembrete-compact-info">
                                        <h4 class="lembrete-title">{{ lembrete.titulo }}</h4>
                                        <div class="d-flex align-items-center">
                                            <div class="lembrete-date me-2">
                                                <i class="bi bi-calendar-event"></i> 
                                                {{ lembrete.data|to_date|format_date }}
                                            </div>
                                            
                                            <div class="lembrete-countdown 
                                                {% if (lembrete.data|to_date - today).days < 0 %}
                                                    lembrete-countdown-danger
                                                {% elif (lembrete.data|to_date - today).days == 0 %}
                                                    lembrete-countdown-today
                                                {% elif (lembrete.data|to_date - today).days <= 3 %}
                                                    lembrete-countdown-warning
                                                {% else %}
                                                    lembrete-countdown-normal
                                                {% endif %}
                                            ">
                                                {% if (lembrete.data|to_date - today).days < 0 %}
                                                    <i class="bi bi-exclamation-triangle"></i> {{ (today - lembrete.data|to_date).days }}d atraso
                                                {% elif (lembrete.data|to_date - today).days == 0 %}
                                                    <i class="bi bi-calendar-check"></i> Hoje!
                                                {% elif (lembrete.data|to_date - today).days == 1 %}
                                                    <i class="bi bi-calendar-date"></i> Amanhã
                                                {% else %}
                                                    <i class="bi bi-calendar"></i> {{ (lembrete.data|to_date - today).days }}d
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {% if lembrete.valor %}
                                    <div class="lembrete-value me-2">R$ {{ lembrete.valor|format_currency }}</div>
                                    {% endif %}
                                    
                                    <div class="lembrete-compact-tags">
                                        <span class="lembrete-tag lembrete-tag-personal">P</span>
                                        
                                        {% if lembrete.recorrente %}
                                        <span class="lembrete-tag lembrete-tag-recurrent">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="lembrete-compact-actions">
                                        <button class="btn btn-sm btn-success btn-concluir-lembrete" data-id="{{ lembrete.id }}" title="Concluir">
                                            <i class="bi bi-check"></i>
                                        </button>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li>
                                                    <a class="dropdown-item btn-editar-lembrete" href="#" data-id="{{ lembrete.id }}">
                                                        <i class="bi bi-pencil me-2"></i> Editar
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item btn-excluir-lembrete text-danger" href="#" data-id="{{ lembrete.id }}">
                                                        <i class="bi bi-trash me-2"></i> Excluir
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <i class="bi bi-bell"></i>
                            <h3>Nenhum lembrete pessoal</h3>
                            <p>Adicione lembretes para não esquecer datas importantes.</p>
                            <button class="btn btn-success btn-adicionar-lembrete" data-tipo-perfil="pessoal">
                                <i class="bi bi-plus-circle"></i> Adicionar Lembrete Pessoal
                            </button>
                        </div>
                    {% endif %}
                </div>
                
                <div id="empresariais-lembretes" style="display: none;">
                    {% if lembretes_empresariais %}
                        {% for lembrete in lembretes_empresariais %}
                            <div class="lembrete-compact">
                                <div class="lembrete-status-bar 
                                    {% if (lembrete.data|to_date - today).days < 0 %}
                                        lembrete-status-danger
                                    {% elif (lembrete.data|to_date - today).days <= 3 %}
                                        lembrete-status-warning
                                    {% elif (lembrete.data|to_date - today).days <= 7 %}
                                        lembrete-status-info
                                    {% else %}
                                        lembrete-status-normal
                                    {% endif %}
                                "></div>
                                <div class="lembrete-compact-body">
                                    <div class="lembrete-compact-info">
                                        <h4 class="lembrete-title">{{ lembrete.titulo }}</h4>
                                        <div class="d-flex align-items-center">
                                            <div class="lembrete-date me-2">
                                                <i class="bi bi-calendar-event"></i> 
                                                {{ lembrete.data|to_date|format_date }}
                                            </div>
                                            
                                            <div class="lembrete-countdown 
                                                {% if (lembrete.data|to_date - today).days < 0 %}
                                                    lembrete-countdown-danger
                                                {% elif (lembrete.data|to_date - today).days == 0 %}
                                                    lembrete-countdown-today
                                                {% elif (lembrete.data|to_date - today).days <= 3 %}
                                                    lembrete-countdown-warning
                                                {% else %}
                                                    lembrete-countdown-normal
                                                {% endif %}
                                            ">
                                                {% if (lembrete.data|to_date - today).days < 0 %}
                                                    <i class="bi bi-exclamation-triangle"></i> {{ (today - lembrete.data|to_date).days }}d atraso
                                                {% elif (lembrete.data|to_date - today).days == 0 %}
                                                    <i class="bi bi-calendar-check"></i> Hoje!
                                                {% elif (lembrete.data|to_date - today).days == 1 %}
                                                    <i class="bi bi-calendar-date"></i> Amanhã
                                                {% else %}
                                                    <i class="bi bi-calendar"></i> {{ (lembrete.data|to_date - today).days }}d
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {% if lembrete.valor %}
                                    <div class="lembrete-value me-2">R$ {{ lembrete.valor|format_currency }}</div>
                                    {% endif %}
                                    
                                    <div class="lembrete-compact-tags">
                                        <span class="lembrete-tag lembrete-tag-business">E</span>
                                        
                                        {% if lembrete.recorrente %}
                                        <span class="lembrete-tag lembrete-tag-recurrent">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="lembrete-compact-actions">
                                        <button class="btn btn-sm btn-success btn-concluir-lembrete" data-id="{{ lembrete.id }}" title="Concluir">
                                            <i class="bi bi-check"></i>
                                        </button>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li>
                                                    <a class="dropdown-item btn-editar-lembrete" href="#" data-id="{{ lembrete.id }}">
                                                        <i class="bi bi-pencil me-2"></i> Editar
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item btn-excluir-lembrete text-danger" href="#" data-id="{{ lembrete.id }}">
                                                        <i class="bi bi-trash me-2"></i> Excluir
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <i class="bi bi-bell"></i>
                            <h3>Nenhum lembrete empresarial</h3>
                            <p>Adicione lembretes para controlar seus compromissos financeiros empresariais.</p>
                            <button class="btn btn-success btn-adicionar-lembrete" data-tipo-perfil="empresarial">
                                <i class="bi bi-plus-circle"></i> Adicionar Lembrete Empresarial
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Botão Flutuante para Adicionar -->
    <a href="#" class="fab-button" data-bs-toggle="modal" data-bs-target="#modalAddLembrete">
        <i class="bi bi-plus"></i>
    </a>
</div>

<!-- Modal para adicionar/editar lembrete -->
<div class="modal fade" id="modalAddLembrete" tabindex="-1" aria-labelledby="modalAddLembreteLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalAddLembreteLabel">Adicionar Lembrete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <form id="form-lembrete" method="POST" action="{{ url_for('web.adicionar_lembrete') }}">
                    <input type="hidden" id="lembrete-id" name="id">
                
                    <div class="mb-3">
                        <label class="form-label">Tipo de Perfil</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="tipo_perfil" id="tipo_perfil_pessoal" autocomplete="off" checked value="pessoal">
                            <label class="btn btn-outline-primary" for="tipo_perfil_pessoal">
                                <i class="bi bi-person me-1"></i> Pessoal
                            </label>
                            
                            <input type="radio" class="btn-check" name="tipo_perfil" id="tipo_perfil_empresarial" autocomplete="off" value="empresarial">
                            <label class="btn btn-outline-primary" for="tipo_perfil_empresarial">
                                <i class="bi bi-building me-1"></i> Empresarial
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="lembrete-titulo" class="form-label">Título*</label>
                        <input type="text" class="form-control" id="lembrete-titulo" name="titulo" required placeholder="Ex: Pagar aluguel">
                    </div>
                    
                    <div class="mb-3">
                        <label for="lembrete-data" class="form-label">Data*</label>
                        <input type="date" class="form-control" id="lembrete-data" name="data" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="lembrete-valor" class="form-label">Valor (opcional)</label>
                        <div class="input-group">
                            <span class="input-group-text">R$</span>
                            <input type="text" class="form-control" id="lembrete-valor" name="valor" placeholder="0,00">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="lembrete-descricao" class="form-label">Descrição (opcional)</label>
                        <textarea class="form-control" id="lembrete-descricao" name="descricao" rows="3"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="lembrete-notificacao" class="form-label">Notificação</label>
                        <select class="form-select" id="lembrete-notificacao" name="notificacao">
                            <option value="0">No dia</option>
                            <option value="1" selected>1 dia antes</option>
                            <option value="2">2 dias antes</option>
                            <option value="3">3 dias antes</option>
                            <option value="7">7 dias antes</option>
                            <option value="14">14 dias antes</option>
                            <option value="30">30 dias antes</option>
                        </select>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="lembrete-recorrente" name="recorrente">
                        <label class="form-check-label" for="lembrete-recorrente">
                            Lembrete recorrente
                        </label>
                    </div>
                    
                    <div class="mb-3" id="div-lembrete-periodicidade" style="display: none;">
                        <label for="lembrete-periodicidade" class="form-label">Periodicidade</label>
                        <select class="form-select" id="lembrete-periodicidade" name="periodicidade">
                            <option value="mensal">Mensal</option>
                            <option value="quinzenal">Quinzenal</option>
                            <option value="semanal">Semanal</option>
                            <option value="anual">Anual</option>
                        </select>
                    </div>
                    
                    <!-- Opções de integração com Google Calendar (Planos Família+) -->
                    <div class="mb-3 form-check" id="google-calendar-integration" style="display: none;">
                        <input class="form-check-input" type="checkbox" id="lembrete-google-calendar" name="google_calendar">
                        <label class="form-check-label" for="lembrete-google-calendar">
                            Adicionar ao Google Calendar
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" form="form-lembrete" class="btn btn-success">Salvar Lembrete</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmação para excluir -->
<div class="modal fade" id="modalConfirmExcluir" tabindex="-1" aria-labelledby="modalConfirmExcluirLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalConfirmExcluirLabel">Confirmar exclusão</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir este lembrete? Esta ação não poderá ser desfeita.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form id="form-excluir-lembrete" method="POST">
                    <button type="submit" class="btn btn-danger">Excluir Lembrete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de detalhes do lembrete (ao clicar no calendário) -->
<div class="modal fade" id="modalDetalhesLembrete" tabindex="-1" aria-labelledby="modalDetalhesLembreteLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalDetalhesLembreteLabel">Detalhes do Lembrete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <div id="detalhe-lembrete-content">
                    <!-- Conteúdo será preenchido via JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Inicializar variável para o plano do usuário
    var plano = "{{ plano }}";
</script>
<script src="{{ url_for('static', filename='js/lembretes.js') }}"></script>
{% endblock %}