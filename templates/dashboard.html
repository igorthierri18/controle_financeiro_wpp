{% extends 'base.html' %}

{% block title %}Dashboard - {{ app_name }}{% endblock %}

{% block custom_styles %}
.header-card {
    background-color: var(--primary-color);
    color: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
    padding: 15px;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.header-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
}

.header-card h2 {
    font-size: 20px;
    margin-bottom: 5px;
}

.header-card p {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 0;
}

.header-card .subtitle {
    font-size: 14px;
    opacity: 0.8;
}

.header-card .icon {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 38px;
    opacity: 0.3;
}

.chart {
    height: 300px;
    width: 100%;
}

.period-buttons {
    display: flex;
    overflow-x: auto;
    white-space: nowrap;
    padding: 10px 0;
    margin-bottom: 10px;
}

.period-buttons .btn {
    flex: 0 0 auto;
    border-radius: 20px;
    margin-right: 10px;
    font-size: 13px;
    padding: 6px 15px;
}

.transaction-date {
    font-size: 14px;
    font-weight: 500;
    margin-top: 15px;
    margin-bottom: 10px;
    color: var(--text-muted);
}

.expense-item {
    padding: 12px 15px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
}

.expense-item:hover {
    background-color: #f8f9fa;
}

.expense-item:last-child {
    border-bottom: none;
}

.expense-item-title {
    font-weight: 500;
    margin-bottom: 0;
    font-size: 14px;
}

.expense-item-subtitle {
    color: var(--text-muted);
    font-size: 12px;
}

.expense-item-amount {
    font-weight: 600;
    color: var(--secondary-color);
    font-size: 15px;
}

.category-pill {
    border-radius: 20px;
    padding: 5px 12px;
    font-size: 12px;
    font-weight: 500;
}

.tab-content {
    padding-top: 15px;
}

.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: white;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
}

.bottom-nav .nav-link {
    text-align: center;
    padding: 12px 0;
    color: var(--text-muted);
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 10px;
}

.bottom-nav .nav-link.active {
    color: var(--primary-color);
}

.bottom-nav .nav-link i {
    font-size: 22px;
    margin-bottom: 2px;
}

.bottom-nav .fab-button {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 50px;
    background-color: var(--primary-color);
    border-radius: 50%;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.profile-toggle {
    border-radius: 20px;
    padding: 8px 15px;
    font-weight: 500;
    margin-bottom: 20px;
    background-color: #f8f9fa;
    display: inline-flex;
    align-items: center;
}

.profile-toggle .profile-icon {
    margin-right: 8px;
}

.widget-container {
    background-color: #f8f9fa;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 20px;
}

.widget-container h5 {
    font-weight: 600;
    margin-bottom: 15px;
}

.widget-item {
    background-color: white;
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.widget-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    color: white;
    font-size: 18px;
    flex-shrink: 0;
}

.widget-title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 3px;
}

.widget-subtitle {
    color: var(--text-muted);
    font-size: 12px;
}

.widget-value {
    margin-left: auto;
    font-weight: 700;
    font-size: 16px;
}

.budget-progress {
    height: 8px;
    background-color: #e9ecef;
    border-radius: 4px;
    margin-top: 5px;
}

.budget-bar {
    height: 100%;
    border-radius: 4px;
}

.chip-filter {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
}

.chip {
    background-color: #f8f9fa;
    border-radius: 20px;
    padding: 5px 15px;
    font-size: 13px;
    cursor: pointer;
    border: 1px solid #e9ecef;
    transition: all 0.2s ease;
}

.chip.active {
    background-color: #28a745;
    color: white;
    border-color: #28a745;
}

.quick-action {
    text-align: center;
    margin-bottom: 20px;
}

.quick-action-button {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 8px;
    background-color: #f8f9fa;
    color: #6c757d;
    font-size: 20px;
    transition: all 0.2s ease;
}

.quick-action-button:hover {
    background-color: #28a745;
    color: white;
    transform: translateY(-3px);
}

.quick-action-label {
    font-size: 12px;
    color: #6c757d;
}

.calendar-view {
    background-color: white;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    margin-bottom: 20px;
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
}

.calendar-day {
    aspect-ratio: 1/1;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-size: 14px;
    position: relative;
    cursor: pointer;
}

.calendar-day.active {
    background-color: #28a745;
    color: white;
}

.calendar-day.has-events::after {
    content: '';
    position: absolute;
    bottom: 3px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background-color: #28a745;
}

.date-indicator {
    position: relative;
    padding-left: 15px;
    margin-bottom: 15px;
    font-weight: 500;
}

.date-indicator::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #28a745;
}

.profile-selector {
    display: flex;
    margin-bottom: 20px;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid #dee2e6;
}

.profile-option {
    flex: 1;
    text-align: center;
    padding: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.profile-option.active {
    background-color: #28a745;
    color: white;
}

.profile-option.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: #f0f0f0;
}

.trend-indicator {
    display: inline-flex;
    align-items: center;
    font-size: 12px;
    margin-left: 5px;
}

.trend-up {
    color: #dc3545;
}

.trend-down {
    color: #28a745;
}

/* Estilos responsivos */
@media (max-width: 576px) {
    .header-card {
        margin-bottom: 15px;
        padding: 12px;
    }
    
    .header-card p {
        font-size: 24px;
    }
    
    .chart {
        height: 250px;
    }
    
    .card-header {
        padding: 12px 15px;
    }
}
{% endblock %}

{% block content %}
    <!-- Seletor de perfil (pessoal/empresarial) -->
    <div class="profile-selector">
        <div class="profile-option active" id="profile-personal">
            <i class="bi bi-person me-1"></i> Perfil Pessoal
        </div>
        {% if usuario.plano == 'familia' or usuario.plano == 'empresarial' %}
        <div class="profile-option" id="profile-business">
            <i class="bi bi-building me-1"></i> Perfil Empresarial
        </div>
        {% else %}
        <div class="profile-option disabled">
            <i class="bi bi-building me-1"></i> Perfil Empresarial
            <span class="badge bg-warning ms-1" style="font-size: 8px;">Plano Familia</span>
        </div>
        {% endif %}
    </div>
    
    <!-- Seletores de período -->
    <div class="period-buttons">
        <button class="btn btn-sm btn-outline-success period-btn" data-period="dia">Hoje</button>
        <button class="btn btn-sm btn-success period-btn" data-period="semana">Esta semana</button>
        <button class="btn btn-sm btn-outline-success period-btn" data-period="mes">Este mês</button>
        <button class="btn btn-sm btn-outline-success period-btn" data-period="ano">Este ano</button>
        <button class="btn btn-sm btn-outline-success period-btn" data-period="custom" data-bs-toggle="modal" data-bs-target="#modalDatePicker">Personalizado</button>
    </div>
    
    <!-- Cartões de resumo -->
    <div class="row">
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="header-card">
                <h2>Despesas</h2>
                <p id="total-despesas">R$ 0,00</p>
                <span class="subtitle" id="period-subtitle">nesta semana</span>
                <div class="trend-indicator trend-up">
                    <i class="bi bi-arrow-up-short"></i> 5.2%
                </div>
                <div class="icon">
                    <i class="bi bi-cash"></i>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="header-card" style="background-color: #4a6cf7;">
                <h2>Receitas</h2>
                <p id="total-receitas">R$ 0,00</p>
                <span class="subtitle" id="period-subtitle-receitas">nesta semana</span>
                <div class="trend-indicator trend-up">
                    <i class="bi bi-arrow-up-short"></i> 2.8%
                </div>
                <div class="icon">
                    <i class="bi bi-wallet2"></i>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="header-card" style="background-color: #6440fb;">
                <h2>Saldo</h2>
                <p id="total-saldo">R$ 0,00</p>
                <span class="subtitle" id="period-subtitle-saldo">nesta semana</span>
                <div class="trend-indicator trend-down">
                    <i class="bi bi-arrow-down-short"></i> 1.3%
                </div>
                <div class="icon">
                    <i class="bi bi-piggy-bank"></i>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="header-card" style="background-color: #34c759;">
                <h2>Economia</h2>
                <p id="percentual-economia">0%</p>
                <span class="subtitle" id="period-subtitle-economia">nesta semana</span>
                <div class="trend-indicator trend-up">
                    <i class="bi bi-arrow-up-short"></i> 3.7%
                </div>
                <div class="icon">
                    <i class="bi bi-graph-up-arrow"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ações rápidas -->
    <div class="row mb-4">
        <div class="col">
            <div class="quick-action">
                <a href="#" class="quick-action-button" data-bs-toggle="modal" data-bs-target="#modalAddTransacao">
                    <i class="bi bi-plus-lg"></i>
                </a>
                <div class="quick-action-label">Adicionar</div>
            </div>
        </div>
        <div class="col">
            <div class="quick-action">
                <a href="#" class="quick-action-button" data-bs-toggle="modal" data-bs-target="#modalScanReceipt">
                    <i class="bi bi-camera"></i>
                </a>
                <div class="quick-action-label">Escanear</div>
            </div>
        </div>
        <div class="col">
            <div class="quick-action">
                <a href="/lembretes" class="quick-action-button">
                    <i class="bi bi-bell"></i>
                </a>
                <div class="quick-action-label">Lembretes</div>
            </div>
        </div>
        <div class="col">
            <div class="quick-action">
                <a href="/relatorios" class="quick-action-button">
                    <i class="bi bi-file-earmark-text"></i>
                </a>
                <div class="quick-action-label">Relatórios</div>
            </div>
        </div>
        <div class="col">
            <div class="quick-action">
                <a href="#" class="quick-action-button" data-bs-toggle="modal" data-bs-target="#modalBudget">
                    <i class="bi bi-clipboard-data"></i>
                </a>
                <div class="quick-action-label">Orçamentos</div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Coluna esquerda -->
        <div class="col-lg-8">
            <!-- Gráfico por categoria -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Análise de Despesas</span>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots-vertical"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" id="btn-chart-category">Por Categoria</a></li>
                            <li><a class="dropdown-item" href="#" id="btn-chart-time">Por Tempo</a></li>
                            <li><a class="dropdown-item" href="#" id="btn-chart-comparison">Comparativo</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/api/exportar/despesas" download>Exportar CSV</a></li>
                            <li><a class="dropdown-item" href="#" id="btn-share-chart">Compartilhar via WhatsApp</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div id="grafico-categoria" class="chart"></div>
                </div>
            </div>
            
            <!-- Lembretes Próximos -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Próximos Lembretes</span>
                    <a href="/lembretes" class="text-decoration-none text-success">Ver todos</a>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush" id="proximos-lembretes">
                        <div class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">Pagar Aluguel</div>
                                <small class="text-muted">10/05/2025</small>
                            </div>
                            <span class="badge bg-danger rounded-pill">2 dias</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">Conta de Energia</div>
                                <small class="text-muted">15/05/2025</small>
                            </div>
                            <span class="badge bg-warning rounded-pill">7 dias</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">Internet</div>
                                <small class="text-muted">20/05/2025</small>
                            </div>
                            <span class="badge bg-success rounded-pill">12 dias</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Últimas transações -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Últimas transações</span>
                    <div>
                        <input type="text" class="form-control form-control-sm" placeholder="Pesquisar..." id="search-transactions">
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="chip-filter px-3 pt-3">
                        <div class="chip active" data-filter="all">Todas</div>
                        <div class="chip" data-filter="expense">Despesas</div>
                        <div class="chip" data-filter="income">Receitas</div>
                        <div class="chip" data-filter="food">Alimentação</div>
                        <div class="chip" data-filter="transport">Transporte</div>
                        <div class="chip" data-filter="housing">Moradia</div>
                    </div>
                    
                    <div id="todas-transacoes">
                        <!-- As transações serão carregadas aqui -->
                        <div class="transaction-date ps-3">12 de Maio, 2025</div>
                        <div class="expense-item d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <div class="category-pill me-3 category-alimentação text-white">🍽️</div>
                                <div>
                                    <h6 class="expense-item-title">Almoço</h6>
                                    <p class="expense-item-subtitle">12/05 • Alimentação</p>
                                </div>
                            </div>
                            <div class="expense-item-amount">- R$ 35,90</div>
                        </div>
                        <div class="expense-item d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <div class="category-pill me-3 category-transporte text-white">🚗</div>
                                <div>
                                    <h6 class="expense-item-title">Uber</h6>
                                    <p class="expense-item-subtitle">12/05 • Transporte</p>
                                </div>
                            </div>
                            <div class="expense-item-amount">- R$ 22,50</div>
                        </div>
                        
                        <div class="transaction-date ps-3">11 de Maio, 2025</div>
                        <div class="expense-item d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <div class="category-pill me-3 bg-success text-white">💰</div>
                                <div>
                                    <h6 class="expense-item-title">Salário</h6>
                                    <p class="expense-item-subtitle">11/05 • Receita</p>
                                </div>
                            </div>
                            <div class="expense-item-amount" style="color: #28a745">+ R$ 3.500,00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Coluna direita (sidebar) -->
        <div class="col-lg-4">
            <!-- Mini Calendário -->
            <div class="calendar-view mb-4">
                <div class="calendar-header">
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <span>Maio 2025</span>
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                
                <div class="text-center mb-2">
                    <div class="d-flex justify-content-between">
                        <small>D</small>
                        <small>S</small>
                        <small>T</small>
                        <small>Q</small>
                        <small>Q</small>
                        <small>S</small>
                        <small>S</small>
                    </div>
                </div>
                
                <div class="calendar-grid">
                    <!-- Exemplo da primeira semana -->
                    <div class="calendar-day">28</div>
                    <div class="calendar-day">29</div>
                    <div class="calendar-day">30</div>
                    <div class="calendar-day">1</div>
                    <div class="calendar-day">2</div>
                    <div class="calendar-day">3</div>
                    <div class="calendar-day">4</div>
                    
                    <!-- Segunda semana -->
                    <div class="calendar-day">5</div>
                    <div class="calendar-day">6</div>
                    <div class="calendar-day">7</div>
                    <div class="calendar-day">8</div>
                    <div class="calendar-day">9</div>
                    <div class="calendar-day">10</div>
                    <div class="calendar-day">11</div>
                    
                    <!-- Terceira semana -->
                    <div class="calendar-day active has-events">12</div>
                    <div class="calendar-day has-events">13</div>
                    <div class="calendar-day has-events">14</div>
                    <div class="calendar-day">15</div>
                    <div class="calendar-day">16</div>
                    <div class="calendar-day">17</div>
                    <div class="calendar-day">18</div>
                </div>
                
                <div class="text-center mt-3">
                    <a href="#" class="btn btn-sm btn-outline-success">Ver Agenda Completa</a>
                </div>
            </div>
            
            <!-- Orçamentos -->
            <div class="widget-container">
                <h5 class="d-flex justify-content-between align-items-center">
                    <span>Orçamentos</span>
                    <a href="#" class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#modalBudget">Editar</a>
                </h5>
                
                <div class="widget-item">
                    <div class="widget-icon" style="background-color: #FFA726;">
                        <i class="bi bi-cart"></i>
                    </div>
                    <div>
                        <div class="widget-title">Alimentação</div>
                        <div class="widget-subtitle">Mensal</div>
                        <div class="budget-progress">
                            <div class="budget-bar" style="width: 65%; background-color: #FFA726;"></div>
                        </div>
                    </div>
                    <div class="widget-value">
                        <div>R$ 650/1000</div>
                        <small class="text-muted">65%</small>
                    </div>
                </div>
                
                <div class="widget-item">
                    <div class="widget-icon" style="background-color: #42A5F5;">
                        <i class="bi bi-car-front"></i>
                    </div>
                    <div>
                        <div class="widget-title">Transporte</div>
                        <div class="widget-subtitle">Mensal</div>
                        <div class="budget-progress">
                            <div class="budget-bar" style="width: 45%; background-color: #42A5F5;"></div>
                        </div>
                    </div>
                    <div class="widget-value">
                        <div>R$ 225/500</div>
                        <small class="text-muted">45%</small>
                    </div>
                </div>
                
                <div class="widget-item">
                    <div class="widget-icon" style="background-color: #66BB6A;">
                        <i class="bi bi-house"></i>
                    </div>
                    <div>
                        <div class="widget-title">Moradia</div>
                        <div class="widget-subtitle">Mensal</div>
                        <div class="budget-progress">
                            <div class="budget-bar" style="width: 80%; background-color: #66BB6A;"></div>
                        </div>
                    </div>
                    <div class="widget-value">
                        <div>R$ 1200/1500</div>
                        <small class="text-muted">80%</small>
                    </div>
                </div>
            </div>
            
            <!-- Dívidas e Financiamentos -->
            <div class="widget-container">
                <h5 class="d-flex justify-content-between align-items-center">
                    <span>Dívidas e Financiamentos</span>
                    <a href="/dividas" class="btn btn-sm btn-outline-success">Ver todos</a>
                </h5>
                
                <div class="widget-item">
                    <div class="widget-icon" style="background-color: #EC407A;">
                        <i class="bi bi-credit-card"></i>
                    </div>
                    <div>
                        <div class="widget-title">Cartão de Crédito</div>
                        <div class="widget-subtitle">Vence em 15/05/2025</div>
                    </div>
                    <div class="widget-value">R$ 2.450,75</div>
                </div>
                
                <div class="widget-item">
                    <div class="widget-icon" style="background-color: #AB47BC;">
                        <i class="bi bi-house-door"></i>
                    </div>
                    <div>
                        <div class="widget-title">Financiamento Imóvel</div>
                        <div class="widget-subtitle">240x (18 pagas)</div>
                    </div>
                    <div class="widget-value">R$ 285.000,00</div>
                </div>
            </div>
            
            <!-- Metas Financeiras -->
            <div class="widget-container">
                <h5 class="d-flex justify-content-between align-items-center">
                    <span>Metas Financeiras</span>
                    <div>
                        <a href="/metas" class="btn btn-sm btn-outline-success">Ver Metas</a>
                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalFinancialGoal">Adicionar</button>
                    </div>
                </h5>
                
                <div class="widget-item">
                    <div class="widget-icon" style="background-color: #26C6DA;">
                        <i class="bi bi-airplane"></i>
                    </div>
                    <div>
                        <div class="widget-title">Viagem de Férias</div>
                        <div class="widget-subtitle">Até Dezembro 2025</div>
                        <div class="budget-progress">
                            <div class="budget-bar" style="width: 35%; background-color: #26C6DA;"></div>
                        </div>
                    </div>
                    <div class="widget-value">
                        <div>R$ 3500/10000</div>
                        <small class="text-muted">35%</small>
                    </div>
                </div>
                
                <div class="widget-item">
                    <div class="widget-icon" style="background-color: #8D6E63;">
                        <i class="bi bi-laptop"></i>
                    </div>
                    <div>
                        <div class="widget-title">Novo Notebook</div>
                        <div class="widget-subtitle">Até Agosto 2025</div>
                        <div class="budget-progress">
                            <div class="budget-bar" style="width: 60%; background-color: #8D6E63;"></div>
                        </div>
                    </div>
                    <div class="widget-value">
                        <div>R$ 3000/5000</div>
                        <small class="text-muted">60%</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Barra de navegação inferior (apenas em mobile) -->
    <div class="bottom-nav d-md-none">
        <div class="container">
            <div class="row">
                <div class="col-3">
                    <a href="/dashboard" class="nav-link active">
                        <i class="bi bi-house-door"></i>
                        <span>Início</span>
                    </a>
                </div>
                <div class="col-3">
                    <a href="/relatorios" class="nav-link">
                        <i class="bi bi-graph-up"></i>
                        <span>Relatórios</span>
                    </a>
                </div>
                <div class="col-3">
                    <a href="/categorias" class="nav-link">
                        <i class="bi bi-tags"></i>
                        <span>Categorias</span>
                    </a>
                </div>
                <div class="col-3">
                    <a href="/perfil" class="nav-link">
                        <i class="bi bi-person"></i>
                        <span>Perfil</span>
                    </a>
                </div>
            </div>
            <a href="#" class="fab-button" data-bs-toggle="modal" data-bs-target="#modalAddTransacao">
                <i class="bi bi-plus"></i>
            </a>
        </div>
    </div>
    
    <!-- Modal para adicionar transação -->
    <div class="modal fade" id="modalAddTransacao" tabindex="-1" aria-labelledby="modalAddTransacaoLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalAddTransacaoLabel">Adicionar Transação</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="transactionTypeTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="tab-despesa" data-bs-toggle="tab" data-bs-target="#despesa-tab-pane" type="button" role="tab">Despesa</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tab-receita" data-bs-toggle="tab" data-bs-target="#receita-tab-pane" type="button" role="tab">Receita</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tab-transferencia" data-bs-toggle="tab" data-bs-target="#transferencia-tab-pane" type="button" role="tab">Transferência</button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="transactionTypeTabsContent">
                        <div class="tab-pane fade show active" id="despesa-tab-pane" role="tabpanel" tabindex="0">
                            <!-- Formulário de despesa -->
                            <form id="form-despesa">
                                <div class="mb-3">
                                    <label for="despesa-valor" class="form-label">Valor</label>
                                    <div class="input-group">
                                        <span class="input-group-text">R$</span>
                                        <input type="number" class="form-control" id="despesa-valor" name="valor" step="0.01" min="0.01" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="despesa-descricao" class="form-label">Descrição</label>
                                    <input type="text" class="form-control" id="despesa-descricao" name="descricao" required>
                                </div>
                                <div class="mb-3">
                                    <label for="despesa-categoria" class="form-label">Categoria</label>
                                    <select class="form-select" id="despesa-categoria" name="categoria" required>
                                        <option value="alimentação">🍽️ Alimentação</option>
                                        <option value="transporte">🚗 Transporte</option>
                                        <option value="moradia">🏠 Moradia</option>
                                        <option value="saúde">⚕️ Saúde</option>
                                        <option value="educação">📚 Educação</option>
                                        <option value="lazer">🎭 Lazer</option>
                                        <option value="vestuário">👕 Vestuário</option>
                                        <option value="outros">📦 Outros</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="despesa-data" class="form-label">Data</label>
                                    <input type="date" class="form-control" id="despesa-data" name="data" required>
                                </div>
                                <div class="mb-3">
                                    <label for="despesa-forma-pagamento" class="form-label">Forma de Pagamento</label>
                                    <select class="form-select" id="despesa-forma-pagamento" name="forma_pagamento">
                                        <option value="">Selecione...</option>
                                        <option value="Dinheiro">Dinheiro</option>
                                        <option value="Débito">Cartão de Débito</option>
                                        <option value="Crédito">Cartão de Crédito</option>
                                        <option value="PIX">PIX</option>
                                        <option value="Transferência">Transferência Bancária</option>
                                        <option value="Boleto">Boleto</option>
                                    </select>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="despesa-parcelada" name="parcelado">
                                    <label class="form-check-label" for="despesa-parcelada">
                                        Despesa parcelada
                                    </label>
                                </div>
                                <div class="mb-3" id="div-parcelas" style="display: none;">
                                    <label for="despesa-parcelas" class="form-label">Número de Parcelas</label>
                                    <input type="number" class="form-control" id="despesa-parcelas" name="num_parcelas" min="2" value="2">
                                </div>
                                <div class="mb-3">
                                    <label for="despesa-tipo-perfil" class="form-label">Perfil</label>
                                    <select class="form-select" id="despesa-tipo-perfil" name="tipo_perfil">
                                        <option value="pessoal" selected>Pessoal</option>
                                        {% if usuario.plano == 'familia' or usuario.plano == 'empresarial' %}
                                        <option value="empresarial">Empresarial</option>
                                        {% endif %}
                                    </select>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success">Salvar Despesa</button>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="receita-tab-pane" role="tabpanel" tabindex="0">
                            <!-- Formulário de receita -->
                            <form id="form-receita">
                                <div class="mb-3">
                                    <label for="receita-valor" class="form-label">Valor</label>
                                    <div class="input-group">
                                        <span class="input-group-text">R$</span>
                                        <input type="number" class="form-control" id="receita-valor" name="valor" step="0.01" min="0.01" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="receita-descricao" class="form-label">Descrição</label>
                                    <input type="text" class="form-control" id="receita-descricao" name="descricao" required>
                                </div>
                                <div class="mb-3">
                                    <label for="receita-categoria" class="form-label">Categoria</label>
                                    <select class="form-select" id="receita-categoria" name="categoria" required>
                                        <option value="salario">💰 Salário</option>
                                        <option value="freelance">💼 Freelance</option>
                                        <option value="investimento">📈 Investimento</option>
                                        <option value="presente">🎁 Presente</option>
                                        <option value="outros">📦 Outros</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="receita-data" class="form-label">Data</label>
                                    <input type="date" class="form-control" id="receita-data" name="data" required>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="receita-recorrente" name="recorrente">
                                    <label class="form-check-label" for="receita-recorrente">
                                        Receita recorrente
                                    </label>
                                </div>
                                <div class="mb-3" id="div-periodicidade" style="display: none;">
                                    <label for="receita-periodicidade" class="form-label">Periodicidade</label>
                                    <select class="form-select" id="receita-periodicidade" name="periodicidade">
                                        <option value="mensal">Mensal</option>
                                        <option value="quinzenal">Quinzenal</option>
                                        <option value="semanal">Semanal</option>
                                        <option value="anual">Anual</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="receita-tipo-perfil" class="form-label">Perfil</label>
                                    <select class="form-select" id="receita-tipo-perfil" name="tipo_perfil">
                                        <option value="pessoal" selected>Pessoal</option>
                                        {% if usuario.plano == 'familia' or usuario.plano == 'empresarial' %}
                                        <option value="empresarial">Empresarial</option>
                                        {% endif %}
                                    </select>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success">Salvar Receita</button>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="transferencia-tab-pane" role="tabpanel" tabindex="0">
                            <!-- Formulário de transferência (nova funcionalidade) -->
                            <form id="form-transferencia">
                                <div class="mb-3">
                                    <label for="transferencia-valor" class="form-label">Valor</label>
                                    <div class="input-group">
                                        <span class="input-group-text">R$</span>
                                        <input type="number" class="form-control" id="transferencia-valor" name="valor" step="0.01" min="0.01" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="transferencia-descricao" class="form-label">Descrição</label>
                                    <input type="text" class="form-control" id="transferencia-descricao" name="descricao" placeholder="Ex: Transferência para poupança" required>
                                </div>
                                <div class="mb-3">
                                    <label for="transferencia-origem" class="form-label">Conta de Origem</label>
                                    <select class="form-select" id="transferencia-origem" name="conta_origem" required>
                                        <option value="conta-corrente">Conta Corrente</option>
                                        <option value="poupanca">Poupança</option>
                                        <option value="investimentos">Investimentos</option>
                                        <option value="dinheiro">Dinheiro</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="transferencia-destino" class="form-label">Conta de Destino</label>
                                    <select class="form-select" id="transferencia-destino" name="conta_destino" required>
                                        <option value="poupanca">Poupança</option>
                                        <option value="conta-corrente">Conta Corrente</option>
                                        <option value="investimentos">Investimentos</option>
                                        <option value="dinheiro">Dinheiro</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="transferencia-data" class="form-label">Data</label>
                                    <input type="date" class="form-control" id="transferencia-data" name="data" required>
                                </div>
                                <div class="mb-3">
                                    <label for="transferencia-tipo-perfil" class="form-label">Perfil</label>
                                    <select class="form-select" id="transferencia-tipo-perfil" name="tipo_perfil">
                                        <option value="pessoal" selected>Pessoal</option>
                                        {% if usuario.plano == 'familia' or usuario.plano == 'empresarial' %}
                                        <option value="empresarial">Empresarial</option>
                                        {% endif %}
                                    </select>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success">Salvar Transferência</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para escanear nota/comprovante -->
    <div class="modal fade" id="modalScanReceipt" tabindex="-1" aria-labelledby="modalScanReceiptLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalScanReceiptLabel">Escanear Comprovante</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <p>Escolha uma opção para adicionar o comprovante:</p>
                        <div class="d-flex justify-content-center gap-3 mb-4">
                            <button class="btn btn-outline-success" id="btn-capture-photo">
                                <i class="bi bi-camera me-2"></i>Tirar Foto
                            </button>
                            <button class="btn btn-outline-primary" id="btn-upload-receipt">
                                <i class="bi bi-upload me-2"></i>Upload
                            </button>
                        </div>
                        
                        <div id="camera-container" style="display: none;">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>Centralize o comprovante no quadro para captura.
                            </div>
                            <div style="width: 100%; height: 300px; background-color: #f8f9fa; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                                <i class="bi bi-camera" style="font-size: 48px; color: #adb5bd;"></i>
                            </div>
                            <button class="btn btn-success" id="btn-take-photo">Capturar</button>
                        </div>
                        
                        <input type="file" id="receipt-upload" accept="image/*" class="d-none">
                        
                        <div id="receipt-preview" style="display: none;">
                            <div class="alert alert-success mb-3">
                                <i class="bi bi-check-circle me-2"></i>Comprovante capturado com sucesso!
                            </div>
                            <div id="preview-image-container" class="mb-3" style="max-height: 250px; overflow: hidden;">
                                <img id="preview-image" src="#" alt="Preview" style="max-width: 100%; height: auto;">
                            </div>
                            <div class="mb-3">
                                <h6>Dados Detectados:</h6>
                                <div class="mb-2">
                                    <label class="form-label">Valor</label>
                                    <input type="text" class="form-control" id="ocr-valor" value="R$ 85,50">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Data</label>
                                    <input type="text" class="form-control" id="ocr-data" value="12/05/2025">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Estabelecimento</label>
                                    <input type="text" class="form-control" id="ocr-estabelecimento" value="Supermercado Exemplo">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Categoria Sugerida</label>
                                    <select class="form-select" id="ocr-categoria">
                                        <option value="alimentação" selected>🍽️ Alimentação</option>
                                        <option value="transporte">🚗 Transporte</option>
                                        <option value="moradia">🏠 Moradia</option>
                                        <option value="outros">📦 Outros</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="scan-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" id="btn-save-receipt" style="display: none;">Salvar Despesa</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para seleção de datas personalizada -->
    <div class="modal fade" id="modalDatePicker" tabindex="-1" aria-labelledby="modalDatePickerLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalDatePickerLabel">Selecionar Período</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="date-inicio" class="form-label">Data de Início</label>
                        <input type="date" class="form-control" id="date-inicio" name="data_inicio">
                    </div>
                    <div class="mb-3">
                        <label for="date-fim" class="form-label">Data de Fim</label>
                        <input type="date" class="form-control" id="date-fim" name="data_fim">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" id="btn-aplicar-datas">Aplicar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para gerenciar orçamentos -->
    <div class="modal fade" id="modalBudget" tabindex="-1" aria-labelledby="modalBudgetLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalBudgetLabel">Gerenciar Orçamentos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs mb-3" id="budgetTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="tab-listar-orcamentos" data-bs-toggle="tab" data-bs-target="#listar-orcamentos-pane" type="button" role="tab">Meus Orçamentos</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tab-novo-orcamento" data-bs-toggle="tab" data-bs-target="#novo-orcamento-pane" type="button" role="tab">Novo Orçamento</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="budgetTabsContent">
                        <div class="tab-pane fade show active" id="listar-orcamentos-pane" role="tabpanel" tabindex="0">
                            <div class="list-group">
                                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">Alimentação</h6>
                                        <p class="mb-1 small text-muted">R$ 1.000,00 / Mensal</p>
                                        <div class="progress" style="height: 5px; width: 150px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 65%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary me-1">Editar</button>
                                        <button class="btn btn-sm btn-outline-danger">Excluir</button>
                                    </div>
                                </div>
                                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">Transporte</h6>
                                        <p class="mb-1 small text-muted">R$ 500,00 / Mensal</p>
                                        <div class="progress" style="height: 5px; width: 150px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 45%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary me-1">Editar</button>
                                        <button class="btn btn-sm btn-outline-danger">Excluir</button>
                                    </div>
                                </div>
                                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">Moradia</h6>
                                        <p class="mb-1 small text-muted">R$ 1.500,00 / Mensal</p>
                                        <div class="progress" style="height: 5px; width: 150px;">
                                            <div class="progress-bar bg-warning" role="progressbar" style="width: 80%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary me-1">Editar</button>
                                        <button class="btn btn-sm btn-outline-danger">Excluir</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="novo-orcamento-pane" role="tabpanel" tabindex="0">
                            <form id="form-orcamento">
                                <div class="mb-3">
                                    <label for="orcamento-categoria" class="form-label">Categoria</label>
                                    <select class="form-select" id="orcamento-categoria" name="categoria" required>
                                        <option value="">Selecione uma categoria</option>
                                        <option value="alimentação">🍽️ Alimentação</option>
                                        <option value="transporte">🚗 Transporte</option>
                                        <option value="moradia">🏠 Moradia</option>
                                        <option value="saúde">⚕️ Saúde</option>
                                        <option value="educação">📚 Educação</option>
                                        <option value="lazer">🎭 Lazer</option>
                                        <option value="vestuário">👕 Vestuário</option>
                                        <option value="outros">📦 Outros</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="orcamento-valor" class="form-label">Valor Limite</label>
                                    <div class="input-group">
                                        <span class="input-group-text">R$</span>
                                        <input type="number" class="form-control" id="orcamento-valor" name="valor" step="0.01" min="0.01" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="orcamento-periodicidade" class="form-label">Periodicidade</label>
                                    <select class="form-select" id="orcamento-periodicidade" name="periodicidade" required>
                                        <option value="mensal" selected>Mensal</option>
                                        <option value="semanal">Semanal</option>
                                        <option value="anual">Anual</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="orcamento-alerta" class="form-label">Alerta quando atingir</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="orcamento-alerta" name="alerta" min="1" max="100" value="80">
                                        <span class="input-group-text">%</span>
                                    </div>
                                    <div class="form-text">Você receberá uma notificação quando atingir esta porcentagem do limite.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="orcamento-tipo-perfil" class="form-label">Perfil</label>
                                    <select class="form-select" id="orcamento-tipo-perfil" name="tipo_perfil">
                                        <option value="pessoal" selected>Pessoal</option>
                                        {% if usuario.plano == 'familia' or usuario.plano == 'empresarial' %}
                                        <option value="empresarial">Empresarial</option>
                                        {% endif %}
                                    </select>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success">Salvar Orçamento</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para adicionar meta financeira -->
    <div class="modal fade" id="modalFinancialGoal" tabindex="-1" aria-labelledby="modalFinancialGoalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalFinancialGoalLabel">Adicionar Meta Financeira</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <form id="form-meta-financeira">
                        <div class="mb-3">
                            <label for="meta-titulo" class="form-label">Nome da Meta</label>
                            <input type="text" class="form-control" id="meta-titulo" name="titulo" required placeholder="Ex: Viagem de Férias">
                        </div>
                        <div class="mb-3">
                            <label for="meta-valor-alvo" class="form-label">Valor a Atingir</label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="meta-valor-alvo" name="valor_alvo" step="0.01" min="0.01" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="meta-valor-atual" class="form-label">Valor Atual (opcional)</label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="meta-valor-atual" name="valor_atual" step="0.01" min="0" value="0">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="meta-data-alvo" class="form-label">Data Limite</label>
                            <input type="date" class="form-control" id="meta-data-alvo" name="data_alvo" required>
                        </div>
                        <div class="mb-3">
                            <label for="meta-icone" class="form-label">Ícone</label>
                            <select class="form-select" id="meta-icone" name="icone">
                                <option value="bi-airplane">✈️ Viagem</option>
                                <option value="bi-house">🏠 Casa</option>
                                <option value="bi-car-front">🚗 Carro</option>
                                <option value="bi-laptop">💻 Eletrônicos</option>
                                <option value="bi-mortarboard">🎓 Educação</option>
                                <option value="bi-piggy-bank">💰 Poupança</option>
                                <option value="bi-gift">🎁 Presente</option>
                                <option value="bi-bank">🏦 Investimento</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="meta-automatico" class="form-label">Contribuição Automática (opcional)</label>
                            <div class="row g-3 align-items-center">
                                <div class="col-auto">
                                    <div class="input-group">
                                        <span class="input-group-text">R$</span>
                                        <input type="number" class="form-control" id="meta-automatico" name="valor_automatico" step="0.01" min="0">
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <select class="form-select" id="meta-periodicidade" name="periodicidade">
                                        <option value="semanal">por semana</option>
                                        <option value="mensal" selected>por mês</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="meta-tipo-perfil" class="form-label">Perfil</label>
                            <select class="form-select" id="meta-tipo-perfil" name="tipo_perfil">
                                <option value="pessoal" selected>Pessoal</option>
                                {% if usuario.plano == 'familia' or usuario.plano == 'empresarial' %}
                                <option value="empresarial">Empresarial</option>
                                {% endif %}
                            </select>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success">Salvar Meta</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    // Variáveis globais
    let periodoAtual = 'semana';
    let dadosGrafico = [];
    let perfilAtual = 'pessoal';
    
    // Funções de formatação
    function formatarData(dataStr) {
        const data = new Date(dataStr);
        return data.toLocaleDateString('pt-BR');
    }
    
    function formatarValor(valor) {
        return 'R$ ' + parseFloat(valor).toFixed(2).replace('.', ',');
    }
    
    // Carrega os dados com base no período selecionado
    async function carregarDados(periodo = 'semana') {
        periodoAtual = periodo;
        
        // Atualiza os subtítulos com o período selecionado
        let textoPeríodo = 'nesta semana';
        if (periodo === 'dia') textoPeríodo = 'hoje';
        if (periodo === 'mes') textoPeríodo = 'neste mês';
        if (periodo === 'ano') textoPeríodo = 'neste ano';
        if (periodo === 'custom') textoPeríodo = 'no período selecionado';
        
        document.getElementById('period-subtitle').textContent = textoPeríodo;
        document.getElementById('period-subtitle-receitas').textContent = textoPeríodo;
        document.getElementById('period-subtitle-saldo').textContent = textoPeríodo;
        document.getElementById('period-subtitle-economia').textContent = textoPeríodo;
        
        try {
            // Prepara os parâmetros da requisição
            let params = `periodo=${periodo}&tipo_perfil=${perfilAtual}`;
            
            // Se for período personalizado, adiciona as datas
            if (periodo === 'custom') {
                const dataInicio = document.getElementById('date-inicio').value;
                const dataFim = document.getElementById('date-fim').value;
                if (dataInicio && dataFim) {
                    params += `&data_inicio=${dataInicio}&data_fim=${dataFim}`;
                }
            }
            
            // Carrega o resumo
            const resumoResponse = await fetch(`/api/resumo?${params}`);
            const resumo = await resumoResponse.json();
            
            // Atualiza os totais
            document.getElementById('total-despesas').textContent = formatarValor(resumo.total_despesas);
            document.getElementById('total-receitas').textContent = formatarValor(resumo.total_receitas);
            document.getElementById('total-saldo').textContent = formatarValor(resumo.saldo);
            document.getElementById('percentual-economia').textContent = `${resumo.economia_percentual}%`;
            
            // Carrega o gráfico por categoria
            const graficoResponse = await fetch(`/api/grafico/por_categoria?${params}`);
            const dadosGrafico = await graficoResponse.json();
            
            // Atualiza o gráfico
            atualizarGrafico(dadosGrafico);
            
            // Carrega as despesas
            const despesasResponse = await fetch(`/api/despesas?${params}`);
            const despesas = await despesasResponse.json();
            
            // Carrega as receitas
            const receitasResponse = await fetch(`/api/receitas?${params}`);
            const receitas = await receitasResponse.json();
            
            // Atualiza as listas de transações
            atualizarListaTransacoes(despesas, receitas);
            
            // Carrega lembretes próximos
            await carregarLembretesProximos();
            
            // Carrega orçamentos
            await carregarOrcamentos();
            
        } catch (error) {
            console.error('Erro ao carregar dados:', error);
            // Mostra mensagem de erro
            alert('Ocorreu um erro ao carregar os dados. Por favor, tente novamente.');
        }
    }
    
    // Função para carregar lembretes próximos
    async function carregarLembretesProximos() {
        try {
            const resposta = await fetch(`/api/lembretes?tipo_perfil=${perfilAtual}&concluido=0`);
            const lembretes = await resposta.json();
            
            // Ordena por data mais próxima
            lembretes.sort((a, b) => new Date(a.data) - new Date(b.data));
            
            // Limita a exibir apenas os 3 próximos
            const proximosLembretes = lembretes.slice(0, 3);
            
            // Atualiza a lista de lembretes
            const container = document.getElementById('proximos-lembretes');
            container.innerHTML = '';
            
            if (proximosLembretes.length === 0) {
                container.innerHTML = `
                <div class="list-group-item text-center py-4">
                    <i class="bi bi-check-circle text-success" style="font-size: 24px;"></i>
                    <p class="mt-2">Não há lembretes próximos</p>
                </div>`;
                return;
            }
            
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            proximosLembretes.forEach(lembrete => {
                const dataLembrete = new Date(lembrete.data);
                dataLembrete.setHours(0, 0, 0, 0);
                
                // Calcula dias restantes
                const diffTime = dataLembrete - hoje;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // Define a cor do badge baseado na proximidade
                let badgeClass = 'bg-success';
                let textoData = `${diffDays} dias`;
                
                if (diffDays < 0) {
                    badgeClass = 'bg-danger';
                    textoData = 'Atrasado';
                } else if (diffDays === 0) {
                    badgeClass = 'bg-warning';
                    textoData = 'Hoje';
                } else if (diffDays <= 3) {
                    badgeClass = 'bg-danger';
                } else if (diffDays <= 7) {
                    badgeClass = 'bg-warning';
                }
                
                container.innerHTML += `
                <div class="list-group-item d-flex justify-content-between align-items-start">
                    <div class="ms-2 me-auto">
                        <div class="fw-bold">${lembrete.titulo}</div>
                        <small class="text-muted">${formatarData(lembrete.data)}</small>
                        ${lembrete.valor ? `<small class="d-block">R$ ${lembrete.valor.toFixed(2)}</small>` : ''}
                    </div>
                    <span class="badge ${badgeClass} rounded-pill">${textoData}</span>
                </div>`;
            });
            
        } catch (error) {
            console.error('Erro ao carregar lembretes:', error);
        }
    }
    
    // Função para carregar orçamentos
    async function carregarOrcamentos() {
        try {
            // Em uma implementação real, buscaria do backend
            // Por enquanto, usamos dados simulados
            
            // Aqui seria a chamada real para a API
            // const resposta = await fetch(`/api/orcamentos?tipo_perfil=${perfilAtual}`);
            // const orcamentos = await resposta.json();
            
            // Atualizar os widgets de orçamento seria feito aqui
            
        } catch (error) {
            console.error('Erro ao carregar orçamentos:', error);
        }
    }
    
    // Atualiza o gráfico
    function atualizarGrafico(dados) {
        if (!dados || !dados.data) {
            console.error('Dados do gráfico inválidos');
            return;
        }
        
        // Renderiza o gráfico com Plotly
        Plotly.newPlot('grafico-categoria', dados.data, dados.layout, {responsive: true});
        
        // Armazena os dados para uso posterior
        dadosGrafico = dados;
    }
    
    // Função para agrupar transações por data
    function agruparTransacoesPorData(transacoes) {
        const grupos = {};
        
        transacoes.forEach(transacao => {
            const data = transacao.data;
            if (!grupos[data]) {
                grupos[data] = [];
            }
            grupos[data].push(transacao);
        });
        
        return grupos;
    }
    
    // Função para criar HTML de uma transação
    function criarHTMLTransacao(transacao, isReceita = false) {
        // Determina o emoji/ícone baseado na categoria
        let emoji = '📦'; // Padrão
        let categoriaClass = 'category-outros';
        let filterClass = isReceita ? 'income' : 'expense';
        
        if (isReceita) {
            emoji = '💰';
            categoriaClass = 'bg-success';
            
            // Ícones específicos para categorias de receita
            if (transacao.categoria === 'salario') emoji = '💵';
            if (transacao.categoria === 'freelance') emoji = '💼';
            if (transacao.categoria === 'investimento') emoji = '📈';
            if (transacao.categoria === 'presente') emoji = '🎁';
        } else {
            // Mapa de categorias para emojis e classes de filtro
            const emojisCategoria = {
                'alimentação': '🍽️',
                'transporte': '🚗',
                'moradia': '🏠',
                'saúde': '⚕️',
                'educação': '📚',
                'lazer': '🎭',
                'vestuário': '👕',
                'outros': '📦'
            };
            
            const filterClasses = {
                'alimentação': 'food',
                'transporte': 'transport',
                'moradia': 'housing',
                'saúde': 'health',
                'educação': 'education',
                'lazer': 'leisure',
                'vestuário': 'clothing',
                'outros': 'other'
            };
            
            emoji = emojisCategoria[transacao.categoria] || '📦';
            categoriaClass = `category-${transacao.categoria}`;
            filterClass = filterClasses[transacao.categoria] || 'other';
        }
        
        // Formata data e hora
        const dataObj = new Date(transacao.data + 'T00:00:00');
        const dataFormatada = dataObj.toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'});
        
        // Formata o valor com sinal + ou -
        const valorFormatado = formatarValor(transacao.valor);
        
        return `
        <div class="expense-item d-flex justify-content-between align-items-center" data-filter="${filterClass}">
            <div class="d-flex align-items-center">
                <div class="category-pill me-3 ${categoriaClass} text-white">${emoji}</div>
                <div>
                    <h6 class="expense-item-title">${transacao.descricao}</h6>
                    <p class="expense-item-subtitle">${dataFormatada} • ${isReceita ? 'Receita' : transacao.categoria.charAt(0).toUpperCase() + transacao.categoria.slice(1)}</p>
                </div>
            </div>
            <div class="expense-item-amount" style="color: ${isReceita ? '#28a745' : '#e74c3c'}">${isReceita ? '+' : '-'} ${valorFormatado}</div>
        </div>
        `;
    }
    
    // Atualiza a lista de transações
    function atualizarListaTransacoes(despesas, receitas) {
        // Agrupa transações por data
        const despesasPorData = agruparTransacoesPorData(despesas);
        const receitasPorData = agruparTransacoesPorData(receitas);
        
        // Combina todas as datas únicas
        const todasDatas = [...new Set([...Object.keys(despesasPorData), ...Object.keys(receitasPorData)])].sort().reverse();
        
        // Container para as transações
        const todasTransacoesContainer = document.getElementById('todas-transacoes');
        
        // Limpa o container
        todasTransacoesContainer.innerHTML = '';
        
        // Se não há transações
        if (todasDatas.length === 0) {
            const mensagemVazia = `
            <div class="text-center py-5">
                <i class="bi bi-receipt text-muted" style="font-size: 48px;"></i>
                <p class="mt-3 text-muted">Nenhuma transação encontrada neste período.</p>
                <button class="btn btn-outline-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalAddTransacao">
                    <i class="bi bi-plus-circle me-1"></i>Adicionar Transação
                </button>
            </div>
            `;
            todasTransacoesContainer.innerHTML = mensagemVazia;
            return;
        }
        
        // Preenche a lista de transações
        todasDatas.forEach(data => {
            const dataObj = new Date(data + 'T00:00:00');
            const dataFormatada = dataObj.toLocaleDateString('pt-BR', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            // Para todas as transações
            if (despesasPorData[data] || receitasPorData[data]) {
                todasTransacoesContainer.innerHTML += `<div class="transaction-date ps-3">${dataFormatada}</div>`;
                
                // Adiciona receitas
                if (receitasPorData[data]) {
                    receitasPorData[data].forEach(receita => {
                        todasTransacoesContainer.innerHTML += criarHTMLTransacao(receita, true);
                    });
                }
                
                // Adiciona despesas
                if (despesasPorData[data]) {
                    despesasPorData[data].forEach(despesa => {
                        todasTransacoesContainer.innerHTML += criarHTMLTransacao(despesa, false);
                    });
                }
            }
        });
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
        // Seletor de perfil (pessoal/empresarial)
        const profilePersonal = document.getElementById('profile-personal');
        const profileBusiness = document.getElementById('profile-business');
        
        profilePersonal.addEventListener('click', function() {
            profilePersonal.classList.add('active');
            profileBusiness.classList.remove('active');
            perfilAtual = 'pessoal';
            carregarDados(periodoAtual);
        });
        
        if (profileBusiness) {
            profileBusiness.addEventListener('click', function() {
                if (this.classList.contains('disabled')) {
                    alert('O perfil empresarial está disponível apenas para os planos Família e Empresarial.');
                    return;
                }
                
                profileBusiness.classList.add('active');
                profilePersonal.classList.remove('active');
                perfilAtual = 'empresarial';
                carregarDados(periodoAtual);
            });
        }
        
        // Event listener para os botões de período
        document.querySelectorAll('.period-btn').forEach(botao => {
            botao.addEventListener('click', function() {
                if (this.dataset.period === 'custom') {
                    // Este botão abre o modal de datas, não altera o período ainda
                    return;
                }
                
                // Remove a classe ativa de todos os botões
                document.querySelectorAll('.period-btn').forEach(btn => {
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-success');
                });
                
                // Adiciona a classe ativa ao botão clicado
                this.classList.remove('btn-outline-success');
                this.classList.add('btn-success');
                
                // Carrega os dados para o período selecionado
                carregarDados(this.dataset.period);
            });
        });
        
        // Botão para aplicar datas personalizadas
        document.getElementById('btn-aplicar-datas').addEventListener('click', function() {
            const dataInicio = document.getElementById('date-inicio').value;
            const dataFim = document.getElementById('date-fim').value;
            
            if (!dataInicio || !dataFim) {
                alert('Por favor, selecione as datas de início e fim');
                return;
            }
            
            // Fecha o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalDatePicker'));
            modal.hide();
            
            // Remove a classe ativa de todos os botões de período
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('btn-success');
                btn.classList.add('btn-outline-success');
            });
            
            // Adiciona a classe ativa ao botão personalizado
            const btnCustom = document.querySelector('.period-btn[data-period="custom"]');
            btnCustom.classList.remove('btn-outline-success');
            btnCustom.classList.add('btn-success');
            
            // Carrega os dados para o período personalizado
            carregarDados('custom');
        });
        
        // Event listener para os botões de tipo de gráfico
        document.getElementById('btn-chart-category').addEventListener('click', function() {
            fetch(`/api/grafico/por_categoria?periodo=${periodoAtual}&tipo_perfil=${perfilAtual}`)
                .then(response => response.json())
                .then(dados => atualizarGrafico(dados));
        });
        
        document.getElementById('btn-chart-time').addEventListener('click', function() {
            fetch(`/api/grafico/por_tempo?periodo=${periodoAtual}&tipo_perfil=${perfilAtual}`)
                .then(response => response.json())
                .then(dados => atualizarGrafico(dados));
        });
        
        document.getElementById('btn-chart-comparison').addEventListener('click', function() {
            fetch(`/api/grafico/comparativo?periodo=${periodoAtual}&tipo_perfil=${perfilAtual}`)
                .then(response => response.json())
                .then(dados => atualizarGrafico(dados));
        });
        
        // Event listener para pesquisa de transações
        document.getElementById('search-transactions').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            
            document.querySelectorAll('#todas-transacoes .expense-item').forEach(item => {
                const title = item.querySelector('.expense-item-title').textContent.toLowerCase();
                const subtitle = item.querySelector('.expense-item-subtitle').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || subtitle.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });
        
        // Event listeners para os filtros por chips
        document.querySelectorAll('.chip').forEach(chip => {
            chip.addEventListener('click', function() {
                // Atualiza as classes ativas
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                
                // Obtém o filtro
                const filtro = this.dataset.filter;
                
                // Aplica o filtro nas transações
                document.querySelectorAll('#todas-transacoes .expense-item').forEach(item => {
                    if (filtro === 'all' || item.dataset.filter === filtro) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });
        
        // Event listener para o formulário de despesa
        document.getElementById('form-despesa').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // Cria um objeto FormData com os dados do formulário
            const formData = new FormData(this);
            
            // Converte FormData para objeto JSON
            const dadosDespesa = {};
            formData.forEach((valor, chave) => {
                // Converte checkboxes para 0 ou 1
                if (chave === 'parcelado') {
                    dadosDespesa[chave] = valor === 'on' ? 1 : 0;
                } else {
                    dadosDespesa[chave] = valor;
                }
            });
            
            try {
                // Envia os dados para a API
                const response = await fetch('/api/despesas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosDespesa)
                });
                
                if (response.ok) {
                    // Fecha o modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalAddTransacao'));
                    modal.hide();
                    
                    // Recarrega os dados
                    carregarDados(periodoAtual);
                    
                    // Limpa o formulário
                    this.reset();
                    
                    // Define a data para hoje
                    document.getElementById('despesa-data').valueAsDate = new Date();
                    
                    // Mostra mensagem de sucesso
                    alert('Despesa adicionada com sucesso!');
                } else {
                    const erro = await response.json();
                    alert(`Erro: ${erro.error || 'Ocorreu um erro ao adicionar a despesa.'}`);
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Ocorreu um erro ao adicionar a despesa. Por favor, tente novamente.');
            }
        });
        
        // Event listener para o formulário de receita
        document.getElementById('form-receita').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // Cria um objeto FormData com os dados do formulário
            const formData = new FormData(this);
            
            // Converte FormData para objeto JSON
            const dadosReceita = {};
            formData.forEach((valor, chave) => {
                // Converte checkboxes para 0 ou 1
                if (chave === 'recorrente') {
                    dadosReceita[chave] = valor === 'on' ? 1 : 0;
                } else {
                    dadosReceita[chave] = valor;
                }
            });
            
            try {
                // Envia os dados para a API
                const response = await fetch('/api/receitas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosReceita)
                });
                
                if (response.ok) {
                    // Fecha o modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('modalAddTransacao'));
                    modal.hide();
                    
                    // Recarrega os dados
                    carregarDados(periodoAtual);
                    
                    // Limpa o formulário
                    this.reset();
                    
                    // Define a data para hoje
                    document.getElementById('receita-data').valueAsDate = new Date();
                    
                    // Mostra mensagem de sucesso
                    alert('Receita adicionada com sucesso!');
                } else {
                    const erro = await response.json();
                    alert(`Erro: ${erro.error || 'Ocorreu um erro ao adicionar a receita.'}`);
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Ocorreu um erro ao adicionar a receita. Por favor, tente novamente.');
            }
        });
        
        // Event listener para o formulário de transferência
        document.getElementById('form-transferencia').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Verificar se a conta de origem e destino são diferentes
            const origem = document.getElementById('transferencia-origem').value;
            const destino = document.getElementById('transferencia-destino').value;
            
            if (origem === destino) {
                alert('A conta de origem e destino devem ser diferentes.');
                return;
            }
            
            // Em uma implementação real, enviaria para o backend
            alert('Transferência registrada com sucesso!');
            
            // Fecha o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalAddTransacao'));
            modal.hide();
            
            // Limpa o formulário
            this.reset();
            
            // Define a data para hoje
            document.getElementById('transferencia-data').valueAsDate = new Date();
            
            // Recarrega os dados
            carregarDados(periodoAtual);
        });
        
        // Event listener para o formulário de orçamento
        document.getElementById('form-orcamento').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Em uma implementação real, enviaria para o backend
            alert('Orçamento salvo com sucesso!');
            
            // Fecha o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalBudget'));
            modal.hide();
            
            // Limpa o formulário
            this.reset();
            
            // Recarrega os dados
            carregarDados(periodoAtual);
        });
        
        // Event listener para o formulário de meta financeira
        document.getElementById('form-meta-financeira').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Em uma implementação real, enviaria para o backend
            alert('Meta financeira adicionada com sucesso!');
            
            // Fecha o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalFinancialGoal'));
            modal.hide();
            
            // Limpa o formulário
            this.reset();
            
            // Recarrega os dados
            carregarDados(periodoAtual);
        });
        
        // Modal para escanear comprovante
        document.getElementById('btn-upload-receipt').addEventListener('click', function() {
            document.getElementById('receipt-upload').click();
        });
        
        document.getElementById('receipt-upload').addEventListener('change', function(event) {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // Oculta o container da câmera
                    document.getElementById('camera-container').style.display = 'none';
                    
                    // Mostra o preview
                    document.getElementById('receipt-preview').style.display = 'block';
                    document.getElementById('preview-image').src = e.target.result;
                    document.getElementById('btn-save-receipt').style.display = 'block';
                }
                
                reader.readAsDataURL(this.files[0]);
            }
        });
        
        document.getElementById('btn-capture-photo').addEventListener('click', function() {
            document.getElementById('camera-container').style.display = 'block';
            document.getElementById('receipt-preview').style.display = 'none';
        });
        
        document.getElementById('btn-take-photo').addEventListener('click', function() {
            // Em uma implementação real, capturaria a foto da câmera
            // Por enquanto, apenas simulamos o processo
            
            document.getElementById('camera-container').style.display = 'none';
            document.getElementById('receipt-preview').style.display = 'block';
            document.getElementById('preview-image').src = 'https://via.placeholder.com/300x400?text=Comprovante+Simulado';
            document.getElementById('btn-save-receipt').style.display = 'block';
        });
        
        document.getElementById('btn-save-receipt').addEventListener('click', function() {
            // Em uma implementação real, salvaria os dados no backend
            alert('Comprovante processado e despesa registrada com sucesso!');
            
            // Fecha o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalScanReceipt'));
            modal.hide();
            
            // Recarrega os dados
            carregarDados(periodoAtual);
        });
        
        // Event listener para mostrar/esconder campos adicionais
        document.getElementById('despesa-parcelada').addEventListener('change', function() {
            document.getElementById('div-parcelas').style.display = this.checked ? 'block' : 'none';
        });
        
        document.getElementById('receita-recorrente').addEventListener('change', function() {
            document.getElementById('div-periodicidade').style.display = this.checked ? 'block' : 'none';
        });
        
        // Botão para compartilhar gráfico via WhatsApp
        document.getElementById('btn-share-chart').addEventListener('click', function() {
            // Obtém a URL da imagem do gráfico
            const urlGrafico = `/api/grafico/imagem?tipo=categoria&periodo=${periodoAtual}&tipo_perfil=${perfilAtual}`;
            
            // Cria a URL do WhatsApp
            const textoCompartilhamento = `Veja meu resumo financeiro ${periodoAtual === 'dia' ? 'de hoje' : 
                                          periodoAtual === 'semana' ? 'desta semana' : 
                                          periodoAtual === 'mes' ? 'deste mês' : 'deste ano'}:`;
            const urlWhatsApp = `https://wa.me/?text=${encodeURIComponent(textoCompartilhamento + "\n" + urlGrafico)}`;
            
            // Abre a URL
            window.open(urlWhatsApp, '_blank');
        });
        
        // Inicialização do dashboard
        // Define a data atual como padrão para os campos de data
        const hoje = new Date();
        hoje.setHours(0, 0, 0, 0);
        
        document.getElementById('despesa-data').valueAsDate = hoje;
        document.getElementById('receita-data').valueAsDate = hoje;
        document.getElementById('transferencia-data').valueAsDate = hoje;
        document.getElementById('date-inicio').valueAsDate = new Date(hoje.getFullYear(), hoje.getMonth(), 1); // Primeiro dia do mês
        document.getElementById('date-fim').valueAsDate = hoje;
        
        const dataLimiteMetaFinanceira = new Date(hoje);
        dataLimiteMetaFinanceira.setMonth(dataLimiteMetaFinanceira.getMonth() + 6); // Data limite padrão: 6 meses a partir de hoje
        document.getElementById('meta-data-alvo').valueAsDate = dataLimiteMetaFinanceira;
        
        // Carrega os dados iniciais
        carregarDados(periodoAtual);
    });
</script>
{% endblock %}